{"version":3,"sources":["../../src/server/WesttownServerEngine.js"],"names":["game","WesttownServerEngine","io","gameEngine","inputOptions","on","gameLogic","bind","TwoVector","MAPS","width","Math","random","height","console","log","MAP","createRoom","i","flag","addFlag","randomPosition","assignObjectToRoom","doors","addDoor","x","y","fromRoom","toRoom","radius","door","wordBlock","addWordBlock","character","position","megaphone","addMegaphone","players","world","queryObjects","instanceType","Player","Door","player","sqrt","assignPlayerToRoom","playerId","room","screenWidth","screenHeight","socket","addPlayer","socketId","o","removeObjectFromWorld","id","ServerEngine"],"mappings":"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","sourcesContent":["import {ServerEngine, TwoVector} from 'lance-gg';\r\nimport Player from '../common/Player';\r\nimport Door from '../common/Door';\r\n\r\nimport {MAPS} from '../common/Maps';\r\n\r\nlet game = null;\r\n\r\nexport default class WesttownServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        game = gameEngine;\r\n\r\n        game.on('postStep', this.gameLogic.bind(this));\r\n    }\r\n\r\n    randomPosition() {\r\n        return new TwoVector(MAPS['/lobby'].width * Math.random(), MAPS['/lobby'].height*Math.random());\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n\r\n        console.log(MAPS);\r\n\r\n        for (let MAP in MAPS) {\r\n            if (MAP != '/lobby') this.createRoom(MAP);\r\n        }\r\n\r\n        for (let i = 0; i < 1; i++ ) {\r\n            let flag = game.addFlag(this.randomPosition());\r\n            this.assignObjectToRoom(flag, \"/lobby\");\r\n        }\r\n\r\n\r\n        console.log('added flags');\r\n\r\n        let doors = [game.addDoor({x: 715, y: 140, fromRoom: '/lobby', toRoom:'/house', radius: 20}),\r\n                    game.addDoor({x: 200, y: 400, fromRoom: '/house', toRoom:'/lobby', radius: 30})\r\n                ];\r\n\r\n\r\n        for (let door of doors) {\r\n            this.assignObjectToRoom(door, door.fromRoom);\r\n        }\r\n\r\n        console.log('added doors');\r\n\r\n        for (let i = 0; i < 1; i++ ) {\r\n            let wordBlock = game.addWordBlock({character: \"\", position: this.randomPosition()});\r\n            this.assignObjectToRoom(wordBlock, \"/lobby\");\r\n\r\n            console.log(wordBlock);\r\n        }\r\n\r\n        console.log('added word blocks');\r\n\r\n        for (let i = 0; i < 1; i++ ) {\r\n            let megaphone = game.addMegaphone(this.randomPosition());\r\n            this.assignObjectToRoom(megaphone, \"/lobby\");\r\n\r\n            console.log(megaphone);\r\n        }\r\n\r\n        console.log('added megaphones');\r\n\r\n\r\n    }\r\n\r\n    gameLogic() {\r\n\r\n        let players = game.world.queryObjects({instanceType: Player});\r\n        let doors = game.world.queryObjects({instanceType: Door});\r\n\r\n        if (!players || !doors) return;\r\n\r\n        for (let player of players) {\r\n\r\n            for( let door of doors) {\r\n                if (Math.sqrt((player.position.x - door.position.x)*(player.position.x - door.position.x) + (player.position.y - door.position.y)*(player.position.y - door.position.y)) <= door.radius) {\r\n                    this.assignObjectToRoom(player, door.toRoom);\r\n                    this.assignPlayerToRoom(player.playerId, door.toRoom);\r\n                    player.room = door.toRoom;\r\n                    player.position.x = game.screenWidth/2;\r\n                    player.position.y = game.screenHeight/2;\r\n\r\n                    console.log(player);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n        game.addPlayer(socket.playerId);\r\n    }\r\n\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n        for (let o of game.world.queryObjects({ playerId }))\r\n            game.removeObjectFromWorld(o.id);\r\n    }\r\n\r\n}"],"file":"WesttownServerEngine.js"}